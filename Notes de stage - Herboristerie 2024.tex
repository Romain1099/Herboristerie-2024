\documentclass[a4paper,11pt,fleqn]{article}

\usepackage[left=1cm,right=0.5cm,top=0.5cm,bottom=2cm]{geometry}

\usepackage{bfcours}
\usepackage{cite} % ou \usepackage{natbib} selon votre style de citation
\usepackage{fontawesome5}
\def\rdifficulty{1}
\setrdexo{%left skip=1cm,
display exotitle,
exo header = tcolorbox,
%display tags,
skin = bouyachakka,
lower ={box=crep},
display score,
display level,
save lower,
score=\points,
level=\rdifficulty,
overlay={\node[inner sep=0pt,
anchor=west,rotate=90, yshift=0.3cm]%,xshift=-3em], yshift=0.45cm
at (frame.south west) {\thetags[0]} ;}
]%obligatoire
}
\setrdcrep{seyes, correction=true, correction color=monrose, correction font = \large\bfseries}

\newcommand{\tikzinclude}[1]{%
    \stepcounter{tikzfigcounter}%
    \csname tikzfig#1\endcsname
}
\input{tex/figures}

\hypersetup{
    pdfauthor={C.Ehrhard - R.Deschamps},
    pdftitle={},
    pdfsubject={},
    pdfkeywords={},
    pdfproducer={LuaLaTeX},
    pdfcreator={Boum Factory}
}

\newcommand{\monimage}[2]{
	\includegraphics[width=#1\textwidth]{Images/#2}
}
\newcommand{\includeplantenature}[4][0.25]{
    \begin{minipage}[t]{#1\textwidth}    
        \phantom{a}
        \begin{center}
            \includegraphics[width=0.8\linewidth]{Images/plantes_nature/#2}
            \captionof{figure}{#3}
            {\footnotesize Plante en milieu naturel\\#4}
        \end{center}
    \end{minipage}
}
\newcommand{\includeplanteseche}[4][0.25]{
    \begin{minipage}[t]{#1\textwidth}    
        \phantom{a}
        \begin{center}
            \includegraphics[width=0.8\linewidth]{Images/plantes_sechees/#2}
            \captionof{figure}{#3}
            {\footnotesize Plante émondée\\#4}
        \end{center}
    \end{minipage}
}
\newcommand{\includeprepa}[4][0.25]{
    \begin{minipage}[t]{#1\textwidth}    
        \phantom{a}
        \begin{center}
            \includegraphics[width=0.8\linewidth]{Images/preparations/#2}
            \captionof{figure}{#3}
            {\footnotesize Préparation\\#4}
        \end{center}
    \end{minipage}
}

\newcommand{\vocref}[2]{
    \href{#1}{\bfseries\color{monrose} #2\index{#2}}
}
\newcommand{\vocnoindexref}[2]{
    \href{#1}{\bfseries\color{monrose} #2}
}

\usepackage{imakeidx}
\makeindex[title=Index des termes, intoc]

\usepackage{datatool}

\definecolor{headerbg}{RGB}{0, 128, 0} % Couleur du fond de l'en-tête
\definecolor{rowbg1}{RGB}{245, 245, 245}
\definecolor{rowbg2}{RGB}{255, 255, 255}

% Charger les données depuis le fichier CSV
%\DTLloaddb{liste148}{Ressources/liste_148.csv}

\definecolor{highlight}{RGB}{255, 255, 0} % Couleur de surlignage
\newcommand{\voc}[1]{\textbf{\color{red!65!black}#1}\index{#1}}

\newcolumntype{L}[1]{>{\raggedright\arraybackslash}p{#1}} % Définir une colonne alignée à gauche avec largeur fixe

% Commande pour créer un tableau pour une plante
\newcommand{\plante}[5]{
\begin{tabular}{|L{3cm}|L{4cm}|L{2cm}|L{3cm}|L{3cm}|}
\hline
\rowcolor{headerbg}
\textcolor{white}{\textbf{Nom français}} & \textcolor{white}{\textbf{Nom latin}} & \textcolor{white}{\textbf{Famille}} & \textcolor{white}{\textbf{Parties utilisées}} & \textcolor{white}{\textbf{Forme de préparation}} \\
\hline
\rowcolor{rowbg1}
#1 & #2 & #3 & #4 & #5 \\
\hline
\end{tabular}
}

\renewcommand\boite[2]{
\begin{tcolorbox}[nobeforeafter,title=\bcfleur #1,halign title=flush left,fonttitle=\bfseries,colbacktitle=headerbg,coltitle=white,colback=white]%red!50!black
#2
\end{tcolorbox}
}

% Définition de la commande \boiteidentiteplante
\NewDocumentEnvironment{boiteidentiteplante}{o+b}{
    \begin{tcolorbox}[
        enhanced,
        before skip=2mm,after skip=2mm,
        colback=red!5,colframe=red!50,boxrule=0pt,
        attach boxed title to top left={xshift=1cm,yshift*=1mm-\tcboxedtitleheight},
        varwidth boxed title*=-3cm,
        boxed title style={frame code={
            \path[fill=blue!50]
            ([yshift=-1mm,xshift=-1mm]frame.north west)
            arc[start angle=0,end angle=180,radius=1mm]
            ([yshift=-1mm,xshift=1mm]frame.north east)
            arc[start angle=180,end angle=0,radius=1mm];
            \path[left color=blue!50,right color=blue!50]
            ([xshift=-2mm]frame.north west) -- ([xshift=2mm]frame.north east)
            [rounded corners=1mm]-- ([xshift=1mm,yshift=-1mm]frame.north east)
            -- (frame.south east) -- (frame.south west)
            -- ([xshift=-1mm,yshift=-1mm]frame.north west)
            [sharp corners]-- cycle;
        },interior engine=empty,
        },
        fonttitle=\bfseries,
        title={\large{Fiche d'identité}},
        coltitle =white,
        drop shadow,
        borderline west={0.05mm}{0pt}{blue!50},
        borderline south={0.05mm}{0pt}{blue!50!black},
        overlay={
            \draw[line width=0.5mm, rem!50] 
            ([xshift=0mm,yshift=-0.25mm]frame.south west)--([xshift=0mm]frame.north west); % Bordure gauche
            \draw[line width=0.5mm, rem!50] 
            ([yshift=0mm]frame.south west)--([yshift=0mm]frame.south east); % Bordure du bas
            \ifx#1\empty
            \else
            \node[anchor=north east, fill=white, draw=rem!50, rounded corners] at ([xshift=-4cm]frame.north east) {\begin{minipage}{0.5\textwidth} \centering \textbf{#1} \end{minipage}};
            \fi%
        }
    ]
    #2
    \end{tcolorbox}
}{}

\NewDocumentEnvironment{boiterecette}{o+b}{
    \begin{tcolorbox}[
        enhanced,
        before skip=2mm,after skip=2mm,
        colback=red!5,colframe=green!30!gray,boxrule=0pt,
        attach boxed title to top left={xshift=1cm,yshift*=1mm-\tcboxedtitleheight},
        varwidth boxed title*=-3cm,
        boxed title style={frame code={
            \path[fill=green!30!gray]
            ([yshift=-1mm,xshift=-1mm]frame.north west)
            arc[start angle=0,end angle=180,radius=1mm]
            ([yshift=-1mm,xshift=1mm]frame.north east)
            arc[start angle=180,end angle=0,radius=1mm];
            \path[left color=green!30!gray,right color=green!30!gray]
            ([xshift=-2mm]frame.north west) -- ([xshift=2mm]frame.north east)
            [rounded corners=1mm]-- ([xshift=1mm,yshift=-1mm]frame.north east)
            -- (frame.south east) -- (frame.south west)
            -- ([xshift=-1mm,yshift=-1mm]frame.north west)
            [sharp corners]-- cycle;
        },interior engine=empty,
        },
        fonttitle=\bfseries,
        title={\large{Recette}},
        coltitle =white,
        drop shadow,
        borderline west={0.05mm}{0pt}{red!40},
        borderline south={0.05mm}{0pt}{red!40!black},
        overlay={
            \draw[line width=0.5mm, rem!50] 
            ([xshift=0mm,yshift=-0.25mm]frame.south west)--([xshift=0mm]frame.north west); % Bordure gauche
            \draw[line width=0.5mm, rem!50] 
            ([yshift=0mm]frame.south west)--([yshift=0mm]frame.south east); % Bordure du bas
            \ifx#1\empty
            \else
            \node[anchor=north east, fill=white, draw=rem!50, rounded corners] at ([xshift=-4cm]frame.north east) {\begin{minipage}{0.5\textwidth} \centering \textbf{#1} \end{minipage}};
            \fi%
        }
    ]
    #2
    \end{tcolorbox}
}{}

% Définition de la commande \ficheidentiteplante
\newcommand{\ficheidentiteplante}[9]{
    \subsubsection{#1}

    \begin{boiteidentiteplante}[#1]

        \begin{multicols}{2}
            \boite{Type d'effet :}{#2}
            \boite{Effets recherchés :}{#3}
        \end{multicols}

        \begin{multicols}{2}
            \begin{bclogo}[couleur=blue!30,arrondi=0.1,logo=\bccalendrier]{Cueillette}
                #4
            \end{bclogo}
            \begin{bclogo}[couleur=blue!30,arrondi=0.1,logo=\bcoutil]{Utilisation privilégiée}
                #5
            \end{bclogo}

	        \columnbreak

	        \begin{center}\includeplantenature[0.4]{#7}{#8}{#9}\end{center}
        \end{multicols}

        #6

    \end{boiteidentiteplante}
}
\newcommand{\ficherecette}[9]{
    \subsubsection{#1}

    \begin{boiterecette}[#1]
        \begin{multicols}{2}
            \begin{bclogo}[couleur=green!30!white,arrondi=0.1,logo=\bcoeil]{Ingrédients}
                \begin{itemize}[label=\mysquare]
                    #2
                \end{itemize}
            \end{bclogo}
            \begin{bclogo}[couleur=green!40!white,arrondi=0.1,logo=\bcoutil]{Matériel}
                \begin{itemize}[label=\mysquare]
                    #3
                \end{itemize}
            \end{bclogo}
        \end{multicols}
        \begin{multicols}{2}
            \begin{bclogo}[couleur=green!50!gray,arrondi=0.1,logo=\bccalendrier]{Conservation}
                #4
            \end{bclogo}
            \begin{bclogo}[couleur=green!40!gray,arrondi=0.1,logo=\bcbook]{Utilisation}
                #5
            \end{bclogo}

	\columnbreak

	    \begin{center}\includeprepa[0.4]{#7}{#8}{#9}\end{center}
    \end{multicols}
        \begin{Remarque}
            #6
        \end{Remarque}
    \end{boiterecette}
}

% Définition de la commande \lien
\newcommand{\lien}[2]{\hyperref[#1]{\bfseries\color{red!50!yellow}#2}}

\begin{document}

\setcounter{pagecounter}{0}
\setcounter{ExoMA}{0}
\setcounter{prof}{0}
%Pour les overlay
\def\points{\phantom{AAA}}
\def\difficulty{\phantom{AAA}}
\chapitre[
    $\mathcal{C}\mathcal{R}$% niveau % $\mathbf{6^{\text{ème}}}$
    ]{
    Herboristerie 2024% theme
    }{
    Association% type_etablissement
    }{
    Arsimed% nom_etablissement
    }{
    \label{exemple}\tableofcontents \newpage% supplement
    }{
    Notes de stage :% type_document
    }

    \section*{Comment utiliser ce document ?}
    \addcontentsline{toc}{section}{Comment utiliser ce document ?}

	\input{tex/divers/how_to.tex}
    \section*{Remerciements}
    \addcontentsline{toc}{section}{Remerciements}
        \input{tex/divers/remerciements.tex}

    \section{Introduction}

        \input{tex/divers/introduction.tex}
    \newpage
    \section{Transformations}

        \input{tex/transformations.tex}

	\newpage
    \section{Botanique}

        \input{tex/botanique.tex}
	\newpage
    \section{Recettes}

        \input{tex/recettes.tex}
	\newpage
    \section{Utilisations médicinales}

        \input{tex/medecine.tex}


    \newpage
    
    \section{Liste des 148}
        \input{Ressources/liste_148.tex}
        
    % Insérer l'index
    \printindex

    \newpage
    \section*{Références}
    \addcontentsline{toc}{section}{Références}
	    \input{tex/references.tex}
\end{document}